# 会員限定ページ保護機能の完全テストガイド

## テスト要求プロンプト

以下のプロンプトを使用して、会員限定ページ保護機能の完全なテストを実行してください：

---

## 🎯 完璧なテストのためのプロンプト

### テスト環境の準備

私は Next.js アプリケーションで会員限定ページ保護機能を実装しました。以下の仕様に基づいて、**完全で抜け漏れのないテスト手順**を提供してください。

### 実装概要
- **AuthGuard コンポーネント**: クライアントサイドの認証保護
- **middleware.ts**: サーバーサイドのルート保護
- **保護されたパス**: `/dashboard`, `/profile`, `/posts/new`, `/posts/*/edit`
- **認証ページ**: `/auth/signin`, `/auth/signup`
- **NextAuth.js**: 認証システム

### テストの要求仕様

以下の項目について、**具体的な操作手順**と**期待される結果**、**確認ポイント**を含む詳細なテスト手順を作成してください：

#### 1. 未認証状態のテスト
- [ ] 保護されたページへの直接アクセス拒否
- [ ] 適切なエラーメッセージの表示
- [ ] サインインページへの自動リダイレクト
- [ ] リダイレクト時のcallbackURLパラメータの保持

#### 2. 認証フローのテスト
- [ ] サインインフォームの入力検証
- [ ] 不正な認証情報でのエラー処理
- [ ] 正常なサインイン処理
- [ ] callbackURLを使用した元ページへの復帰
- [ ] callbackURLがない場合のデフォルトリダイレクト

#### 3. セッション管理のテスト
- [ ] ページリロード後のセッション維持
- [ ] 異なるタブ間でのセッション共有
- [ ] セッションタイムアウトの処理
- [ ] ログアウト後のアクセス制限

#### 4. API保護のテスト
- [ ] 保護されたAPIエンドポイントへの未認証アクセス
- [ ] 認証済みAPIリクエストの成功
- [ ] APIレスポンスのステータスコード確認

#### 5. UI/UXのテスト
- [ ] ローディング状態の表示（スピナー、スケルトン等）
- [ ] エラーメッセージの適切な表示位置とスタイル
- [ ] モバイル/タブレット/デスクトップでのレスポンシブ対応
- [ ] アクセシビリティ（キーボードナビゲーション、スクリーンリーダー）

#### 6. エッジケースのテスト
- [ ] ネットワークエラー時の処理
- [ ] 同時に複数のタブでログイン/ログアウト
- [ ] ブラウザの戻る/進むボタンの動作
- [ ] クッキー無効化時の動作
- [ ] JavaScript無効化時の動作（該当する場合）

#### 7. メール確認機能のテスト（実装されている場合）
- [ ] メール未確認ユーザーのアクセス制限
- [ ] メール確認ページへのリダイレクト
- [ ] メール確認後の適切なリダイレクト

### テスト実行の詳細要求

各テストケースについて、以下の形式で記載してください：

```markdown
## テストケース: [テストケース名]

### 前提条件
- [必要な事前準備]

### テスト手順
1. [具体的な操作手順]
2. [次の操作]
3. [...]

### 期待される結果
- ✅ [期待される動作や表示]
- ✅ [確認すべきポイント]

### 確認項目
- [ ] [チェック項目1]
- [ ] [チェック項目2]

### デバッグ用確認コマンド（開発者ツール）
```javascript
// コンソールで実行する確認コマンド
console.log(/* 確認内容 */);
```

### 失敗時の対処法
- [エラーが発生した場合の確認ポイント]
- [ログの確認場所]
```

### 追加要求

1. **テストデータの準備**
   - テスト用ユーザーアカウントの作成手順
   - 必要な環境変数の設定
   - データベースの初期化方法

2. **自動テストスクリプト**
   - Cypress/Playwright を使用したE2Eテストコード例
   - Jest を使用したユニットテスト例

3. **パフォーマンステスト**
   - 認証処理の応答時間測定方法
   - 大量の同時アクセス時の挙動確認

4. **セキュリティテスト**
   - CSRF対策の確認
   - XSS対策の確認
   - セッション固定攻撃への対策確認

### 最終チェックリスト

テスト完了後、以下の項目すべてが「はい」であることを確認してください：

- [ ] すべての保護されたページで認証が機能している
- [ ] 適切なエラーハンドリングが実装されている
- [ ] ユーザー体験が損なわれていない
- [ ] セキュリティ上の脆弱性がない
- [ ] パフォーマンスが許容範囲内である
- [ ] アクセシビリティ要件を満たしている

---

## 📋 テスト実行記録テンプレート

```markdown
# テスト実行記録

## テスト環境
- 日時: [YYYY-MM-DD HH:MM]
- ブラウザ: [Chrome/Firefox/Safari/Edge] バージョン: [X.X]
- OS: [Windows/Mac/Linux]
- Node.js: [バージョン]
- テスター: [名前]

## テスト結果サマリ
- 成功: [X]件
- 失敗: [X]件
- スキップ: [X]件

## 詳細結果
[各テストケースの結果を記載]

## 発見された問題
1. [問題の説明]
   - 重要度: [Critical/High/Medium/Low]
   - 再現手順: [...]
   - 期待される動作: [...]
   - 実際の動作: [...]

## 改善提案
- [改善点1]
- [改善点2]
```

---

このプロンプトを使用することで、包括的で抜け漏れのないテストを実行できます。