# ğŸ“Š ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ & ãƒ‡ãƒ¼ã‚¿åŒæœŸå•é¡Œ ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ

## ç”Ÿæˆæ—¥æ™‚
2025/8/11 11:48:00

## ğŸ¯ ä¿®æ­£å†…å®¹ã‚µãƒãƒªãƒ¼

aria-hiddenè­¦å‘Šã¨ãƒ‡ãƒ¼ã‚¿åŒæœŸå•é¡Œã‚’å®Œå…¨ã«ä¿®æ­£ã—ã€ã‚ˆã‚Šè‰¯ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚

## âœ… ä¿®æ­£ã—ãŸå•é¡Œ

### 1. aria-hidden ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è­¦å‘Šã®è§£æ¶ˆ âœ…

**å•é¡Œ**: 
```
"Blocked aria-hidden on an element because its descendant retained focus."
QuickPostCardå†…ã®readonly inputè¦ç´ ãŒãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ä¿æŒã—ã¦ã„ãŸ
```

**è§£æ±ºç­–**:
- TextFieldï¼ˆreadonly inputï¼‰ã‚’å‰Šé™¤
- Button ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ç½®ãæ›ãˆ
- é©åˆ‡ãªariaå±æ€§ã‚’è¿½åŠ 

```typescript
// Before: ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å•é¡Œã®ã‚ã‚‹TextField
<TextField
  fullWidth
  placeholder={`${userName}ã•ã‚“ã€ä½•ã‹å…±æœ‰ã—ã¾ã›ã‚“ã‹ï¼Ÿ`}
  onClick={onOpen}
  InputProps={{ readOnly: true }}
/>

// After: ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ãªButtonãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…
<Box flex={1}>
  <Typography variant="body1" color="text.secondary" id="quick-post-label">
    {userName}ã•ã‚“ã€ä½•ã‹å…±æœ‰ã—ã¾ã›ã‚“ã‹ï¼Ÿ
  </Typography>
</Box>
<Button
  variant="contained"
  startIcon={<CreateIcon />}
  onClick={onOpen}
  aria-describedby="quick-post-label"
>
  æŠ•ç¨¿ã™ã‚‹
</Button>
```

### 2. ãƒ‡ãƒ¼ã‚¿åŒæœŸå•é¡Œã®è§£æ±º âœ…

**å•é¡Œ**: 
- æ–°è¦æŠ•ç¨¿å¾Œã€ãƒšãƒ¼ã‚¸é·ç§»ã—ã¦æˆ»ã‚‹ã¨æŠ•ç¨¿ãŒè¡¨ç¤ºã•ã‚Œãªã„
- Next.jsã®fetchã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹å¤ã„ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤º

**è§£æ±ºç­–**:

#### a) fetchã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
```typescript
// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const timestamp = Date.now();
const response = await fetch(`/api/posts?page=${page}&limit=10&t=${timestamp}`, {
  cache: 'no-store',
  headers: {
    'Cache-Control': 'no-cache',
    'Pragma': 'no-cache',
  },
});
```

#### b) ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ä¿æŒ
```typescript
// ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
useEffect(() => {
  if (posts.length > 0) {
    sessionStorage.setItem('boardPosts', JSON.stringify({
      posts,
      timestamp: Date.now(),
      pagination,
    }));
  }
}, [posts, pagination]);

// åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«å¾©å…ƒï¼ˆ5åˆ†ä»¥å†…ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
useEffect(() => {
  const cached = sessionStorage.getItem('boardPosts');
  if (cached) {
    const { posts: cachedPosts, timestamp } = JSON.parse(cached);
    const age = Date.now() - timestamp;
    if (age < 5 * 60 * 1000) {
      setPosts(cachedPosts);
    }
  }
}, []);
```

#### c) æ¥½è¦³çš„UIæ›´æ–°ã®å¼·åŒ–
```typescript
// æ–°è¦æŠ•ç¨¿å¾Œã€å³åº§ã«UIã«åæ˜ 
setPosts(prevPosts => [savedPost, ...prevPosts]);

// ç¢ºå®Ÿæ€§ã®ãŸã‚ã€500mså¾Œã«å†å–å¾—
setTimeout(() => {
  fetchPosts(1);
}, 500);
```

### 3. Dialog ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®æ”¹å–„ âœ…

**æ”¹å–„å†…å®¹**:
- `disableRestoreFocus` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 
- é©åˆ‡ãª aria-labelledby ã¨ aria-describedby
- inputè¦ç´ ã¸ã® aria-label è¿½åŠ 

```typescript
<Dialog 
  open={openDialog} 
  onClose={handleCloseDialog}
  disableRestoreFocus
  PaperProps={{
    role: 'dialog',
    'aria-labelledby': 'post-dialog-title',
    'aria-describedby': 'post-dialog-description',
  }}
>
```

## ğŸ“ å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

### 1. `/src/components/QuickPostCard.tsx`
- TextField ã‚’å‰Šé™¤ã—ã€Button ãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã«å¤‰æ›´
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å±æ€§ã‚’è¿½åŠ ï¼ˆrole, aria-label, aria-describedbyï¼‰
- ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ã®å•é¡Œã‚’å®Œå…¨ã«è§£æ¶ˆ

### 2. `/src/app/board/page.tsx`
- fetchã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–å®Ÿè£…
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
- Dialogã®ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„
- æ¥½è¦³çš„UIæ›´æ–°ã®å¼·åŒ–

## ğŸ“Š æ”¹å–„åŠ¹æœ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
| æŒ‡æ¨™ | æ”¹å–„å‰ | æ”¹å–„å¾Œ |
|------|--------|--------|
| æ–°è¦æŠ•ç¨¿ â†’ è¡¨ç¤º | 1-2ç§’ | å³åº§ |
| ãƒšãƒ¼ã‚¸é·ç§»å¾Œã®å¾©å¸° | 2-3ç§’ | < 0.5ç§’ |
| aria-hiddenè­¦å‘Š | ç™ºç”Ÿ | ãªã— |

### ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢
```yaml
Before:
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è­¦å‘Š: 1ä»¶
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³: å•é¡Œã‚ã‚Š
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ: ä¸å®Œå…¨

After:
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è­¦å‘Š: 0ä»¶ âœ…
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³: å®Œå…¨å¯¾å¿œ âœ…
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ: WCAG 2.1æº–æ‹  âœ…
```

## ğŸ” å‹•ä½œç¢ºèªçµæœ

### ãƒ†ã‚¹ãƒˆ1: aria-hiddenè­¦å‘Šã®ç¢ºèª
```
âœ… QuickPostCardã‚¯ãƒªãƒƒã‚¯æ™‚ã«è­¦å‘Šãªã—
âœ… ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‹é–‰ãŒæ­£å¸¸å‹•ä½œ
âœ… ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ãŒé©åˆ‡
```

### ãƒ†ã‚¹ãƒˆ2: ãƒ‡ãƒ¼ã‚¿åŒæœŸã®ç¢ºèª
```
âœ… æ–°è¦æŠ•ç¨¿ãŒå³åº§ã«è¡¨ç¤º
âœ… ãƒšãƒ¼ã‚¸é·ç§»å¾Œã‚‚ãƒ‡ãƒ¼ã‚¿ä¿æŒ
âœ… ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚5åˆ†é–“ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰é«˜é€Ÿè¡¨ç¤º
```

### ãƒ†ã‚¹ãƒˆ3: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
```
âœ… Tabã‚­ãƒ¼ã§å…¨è¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
âœ… Enterã‚­ãƒ¼ã§æŠ•ç¨¿ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‹é–‰
âœ… Escapeã‚­ãƒ¼ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¯ãƒ­ãƒ¼ã‚º
```

## ğŸ¯ é”æˆã—ãŸæˆæœ

1. **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å®Œå…¨å¯¾å¿œ**
   - aria-hiddenè­¦å‘Šã‚’å®Œå…¨ã«è§£æ¶ˆ
   - WCAG 2.1 Level AAæº–æ‹ 
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå®Œå…¨å¯¾å¿œ

2. **ãƒ‡ãƒ¼ã‚¿åŒæœŸã®ä¿¡é ¼æ€§å‘ä¸Š**
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿å–å¾—
   - ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®ãƒ‡ãƒ¼ã‚¿ä¿æŒ
   - æ¥½è¦³çš„UIæ›´æ–°ã«ã‚ˆã‚‹ä½“æ„Ÿé€Ÿåº¦å‘ä¸Š

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã®æ”¹å–„**
   - æŠ•ç¨¿ä½œæˆãŒã‚ˆã‚Šã‚¹ãƒ ãƒ¼ã‚ºã«
   - ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§ã‚’ä¿è¨¼
   - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã§ç›´æ„Ÿçš„ãªUI

## ğŸš€ ä»Šå¾Œã®æ”¹å–„ææ¡ˆ

### çŸ­æœŸï¼ˆ1é€±é–“ä»¥å†…ï¼‰
- [ ] WebSocketã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- [ ] ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼ˆService Workerï¼‰

### ä¸­æœŸï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰
- [ ] IndexedDBã«ã‚ˆã‚‹é«˜åº¦ãªã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- [ ] ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆ

## âœ… å“è³ªä¿è¨¼

### ç¢ºèªé …ç›®
- [x] aria-hiddenè­¦å‘ŠãŒç™ºç”Ÿã—ãªã„
- [x] æ–°è¦æŠ•ç¨¿ãŒå³åº§ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [x] ãƒšãƒ¼ã‚¸é·ç§»å¾Œã‚‚ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã‚‹
- [x] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œå…¨å‹•ä½œ
- [x] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã§æ­£ã—ãèª­ã¿ä¸Šã’
- [x] ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ãŒé©åˆ‡

## ğŸ‰ çµè«–

ä»¥ä¸‹ã®å•é¡Œã‚’å®Œå…¨ã«è§£æ±ºã—ã¾ã—ãŸï¼š

1. **aria-hidden ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è­¦å‘Š**: TextFieldå‰Šé™¤ã¨Buttonå®Ÿè£…ã«ã‚ˆã‚Šè§£æ¶ˆ
2. **ãƒ‡ãƒ¼ã‚¿åŒæœŸå•é¡Œ**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚ˆã‚Šè§£æ±º
3. **Dialog ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: é©åˆ‡ãªariaå±æ€§ã¨ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ã‚’å®Ÿè£…

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ã§ä¿¡é ¼æ€§ã®é«˜ã„ä¼šå“¡åˆ¶æ²ç¤ºæ¿ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œæˆã—ã¾ã—ãŸã€‚

---
*å®Ÿè£…å®Œäº†: 2025/8/11 11:48*