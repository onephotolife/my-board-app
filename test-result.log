
> my-board-app@0.1.0 test:resend
> node scripts/test-comprehensive-resend.js

テスト対象URL: http://localhost:3000
開始時刻: 2025-08-11T05:28:53.853Z

======================================================================
[1m🚀 メール再送信機能 - 包括的検証テスト開始[0m
======================================================================

--------------------------------------------------
[36m1. 機能テスト (Functional Testing)[0m
--------------------------------------------------
[36m
🧪 [機能テスト] 正常な再送信フロー[0m
[32m✅ 基本的な再送信フロー: レスポンス構造正常[0m
[35m📊 レスポンス時間: 548ms[0m
[35m📊 クールダウン: 60秒[0m
[36m
🧪 [機能テスト] 理由別再送信処理[0m
[32m✅ 理由「not_received」: 正常処理[0m
[32m✅ 理由「expired」: 正常処理[0m
[32m✅ 理由「spam_folder」: 正常処理[0m
[32m✅ 理由「other」: 正常処理[0m
[36m
🧪 [機能テスト] 再送信回数制限[0m
[34mℹ️  試行 1: ステータス 200[0m
[34mℹ️  試行 2: ステータス 200[0m
[34mℹ️  試行 3: ステータス 200[0m
[34mℹ️  試行 4: ステータス 200[0m
[34mℹ️  試行 5: ステータス 200[0m
[34mℹ️  試行 6: ステータス 200[0m
[36m
🧪 [機能テスト] エッジケース検証[0m
[32m✅ 存在しないメールアドレス: 期待通りのステータス 200[0m
[32m✅ 空のメールアドレス: 期待通りのステータス 400[0m
[32m✅ 無効なメール形式: 期待通りのステータス 400[0m
[32m✅ 超長文字列: 期待通りのステータス 400[0m

--------------------------------------------------
[36m2. セキュリティテスト (Security Testing)[0m
--------------------------------------------------
[36m
🧪 [セキュリティ] レート制限検証[0m
[32m✅ レート制限テスト完了: 5回のリクエスト後[0m
[36m
🧪 [セキュリティ] タイミング攻撃対策[0m
[35m📊 存在しないユーザー平均: 245.00ms[0m
[35m📊 通常ユーザー平均: 218.80ms[0m
[35m📊 時間差: 26.20ms[0m
[32m✅ タイミング差が閾値内: 26.20ms < 100ms[0m
[36m
🧪 [セキュリティ] 入力検証[0m
[32m✅ SQLインジェクション: 正しくブロック (400)[0m
[32m✅ XSS攻撃: 正しくブロック (400)[0m
[32m✅ メールヘッダーインジェクション: 正しくブロック (400)[0m
[32m✅ Unicode制御文字: 正しくブロック (400)[0m
[32m✅ null値: 正しくブロック (400)[0m
[32m✅ 型不一致: 正しくブロック (400)[0m
[36m
🧪 [セキュリティ] 指数バックオフ検証[0m
[34mℹ️  試行 1: クールダウン 60秒[0m
[34mℹ️  試行 2: クールダウン 60秒[0m
[34mℹ️  試行 3: クールダウン 60秒[0m
[34mℹ️  試行 4: クールダウン 60秒[0m
[32m✅ バックオフ機能が動作[0m
[35m📊 クールダウン推移: 60 → 60 → 60 → 60秒[0m

--------------------------------------------------
[36m3. パフォーマンステスト (Performance Testing)[0m
--------------------------------------------------
[36m
🧪 [パフォーマンス] レスポンス時間測定[0m
[35m📊 平均応答時間: 243.70ms[0m
[35m📊 最小: 148ms[0m
[35m📊 最大: 329ms[0m
[35m📊 P50: 265ms[0m
[35m📊 P95: 329ms[0m
[32m✅ P95応答時間が基準内: 329ms < 500ms[0m
[36m
🧪 [パフォーマンス] 同時リクエスト処理[0m
[34mℹ️  10 件の同時リクエストを送信[0m
[35m📊 成功: 10/10[0m
[35m📊 エラー: 0/10[0m
[35m📊 レート制限: 0/10[0m
[35m📊 総処理時間: 686ms[0m
[35m📊 平均処理時間: 68.60ms[0m
[32m✅ エラー率が基準内: 0.0% < 10%[0m
[36m
🧪 [パフォーマンス] 持続負荷テスト[0m
[34mℹ️  10秒間、5 RPS で負荷テスト[0m
[35m📊 総リクエスト数: 50[0m
[35m📊 成功: 50[0m
[35m📊 エラー: 0[0m
[35m📊 実際のRPS: 4.14[0m
[35m📊 エラー率: 0.00%[0m
[32m✅ 持続負荷下でのエラー率が基準内: 0.00%[0m

--------------------------------------------------
[36m4. 統合テスト (Integration Testing)[0m
--------------------------------------------------
[36m
🧪 [統合テスト] データベース統合[0m
[32m✅ 初回リクエストでattemptNumber=1を確認[0m
[32m✅ 履歴記録確認: attemptNumber=1[0m
[35m📊 試行回数: 1[0m
[36m
🧪 [統合テスト] キューシステム統合[0m
[32m✅ キューシステムが正常に動作[0m
[36m
🧪 [統合テスト] メトリクス収集統合[0m
[32m✅ メトリクス収集が有効（ログ出力で確認）[0m

--------------------------------------------------
[36m5. UIテスト (UI Testing)[0m
--------------------------------------------------
[33m⚠️  UIテストはブラウザ環境が必要です。E2Eテストツールの使用を推奨します。[0m
[36m
🧪 [UIテスト] UI用APIレスポンス構造[0m
[32m✅ UIに必要なレスポンス構造が含まれている[0m
[34mℹ️  利用可能なUIフィールド: cooldownSeconds, retriesRemaining, checkSpamFolder[0m

======================================================================
[1m📊 テスト結果レポート[0m
======================================================================

実行時間: 31.86 秒
総テスト数: 15
[32m✅ 成功: 14[0m
[31m❌ 失敗: 1[0m
成功率: 93.3%

📋 カテゴリ別結果:
┌─────────────────────┬──────┬──────┬──────┬──────┬─────────┐
│ カテゴリ            │ 総数 │ 成功 │ 失敗 │ Skip │ 成功率  │
├─────────────────────┼──────┼──────┼──────┼──────┼─────────┤
│ 機能テスト                │    4 │    3 │    1 │    0 │   75.0% │
│ セキュリティ               │    4 │    4 │    0 │    0 │  100.0% │
│ パフォーマンス              │    3 │    3 │    0 │    0 │  100.0% │
│ 統合テスト                │    3 │    3 │    0 │    0 │  100.0% │
│ UIテスト                │    1 │    1 │    0 │    0 │  100.0% │
└─────────────────────┴──────┴──────┴──────┴──────┴─────────┘

⚠️  エラー詳細:

[機能テスト]
  1. 最大試行回数制限に達しなかった

📈 パフォーマンスメトリクス:

[機能テスト]
  基本フロー応答時間: 548ms

[セキュリティ]
  レート制限発動: 5回目
  タイミング差: 26.20ms

[パフォーマンス]
  P95応答時間: 329ms
  同時処理エラー率: 0.0%
  持続負荷エラー率: 0.00%

======================================================================
[1m📋 成功基準評価[0m
======================================================================
❌ 機能テスト合格率: 75.0% (目標: 100%) - FAIL
✅ セキュリティテスト合格率: 100.0% (目標: 100%) - PASS
✅ 全体成功率: 93.3% (目標: 80%) - PASS
[31m❌ 
⚠️  一部の必須基準を満たしていません。[0m
