#!/bin/sh
# pre-commit hook - Focused on TypeScript type definition import errors
# Prevents commits with critical errors (.d/.d.ts imports)

echo "ğŸ” Running focused ESLint checks before commit..."

# Check only for .d and .d.ts import violations in staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$')

if [ -z "$STAGED_FILES" ]; then
  echo "âœ… No JavaScript/TypeScript files to check."
  exit 0
fi

# Check for .d or .d.ts import violations
VIOLATIONS_FOUND=false
for file in $STAGED_FILES; do
  if [ -f "$file" ]; then
    # Check for .d or .d.ts imports
    if grep -E "from\s+['\"][^'\"]+\.d(\.ts)?['\"]" "$file" > /dev/null 2>&1; then
      echo "âŒ Error in $file: Found .d or .d.ts extension in import"
      echo "   TypeScriptå‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ‹¡å¼µå­ãªã—ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„"
      echo "   ä¾‹: import { Type } from '@/types/module'"
      VIOLATIONS_FOUND=true
    fi
  fi
done

if [ "$VIOLATIONS_FOUND" = true ]; then
  echo ""
  echo "âŒ Pre-commit check failed: TypeScript import violations found"
  echo "ğŸ’¡ Fix the .d/.d.ts extensions in imports before committing"
  exit 1
fi

# Optional: Run full lint on staged files only (commented out due to many existing errors)
# echo "Running full ESLint on staged files..."
# npx eslint $STAGED_FILES
# if [ $? -ne 0 ]; then
#   echo "âŒ ESLint errors found. Run 'npm run lint:fix' to auto-fix some issues."
#   exit 1
# fi

echo "âœ… Pre-commit check passed. No .d/.d.ts import violations found."
exit 0