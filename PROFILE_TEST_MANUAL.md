# プロフィール機能 手動テスト手順書

## 事前準備

### 1. テストユーザーの作成
```bash
# MongoDBが起動していることを確認
# テストユーザーを作成
node test-profile-setup.js
```

### 2. 開発サーバーの起動
```bash
npm run dev
```

## テスト項目と手順

### 🔐 Test 1: 認証チェック（未ログイン時）

**目的**: 未ログイン時にプロフィールページへアクセスできないことを確認

1. ブラウザを開き、直接 `http://localhost:3000/profile` にアクセス
2. **期待結果**: 
   - `/auth/signin?callbackUrl=/profile` へリダイレクトされる
   - ログインページが表示される

**チェックポイント**:
- ✅ リダイレクトが正しく動作するか
- ✅ callbackURLパラメータが保持されているか

---

### 👤 Test 2: プロフィール表示の確認

**目的**: ログイン後、プロフィール情報が正しく表示されることを確認

1. ログインページで以下の情報を入力:
   - Email: `profile.test@example.com`
   - Password: `Test1234!`
2. ログインボタンをクリック
3. プロフィールページ (`/profile`) に遷移

**期待結果**:
- ユーザー名: 「テストユーザー」が表示される
- メールアドレス: `profile.test@example.com` が表示される
- 自己紹介: 「これはテスト用のプロフィールです。」が表示される
- アバター: 「テ」または「テス」の頭文字が表示される
- メール確認状態: 「確認済み」チップが表示される

**チェックポイント**:
- ✅ アバターの背景色が一貫している
- ✅ メールアドレスフィールドが編集不可
- ✅ 編集ボタンが表示されている

---

### ✏️ Test 3: 名前と自己紹介の更新

**目的**: プロフィール情報を正常に更新できることを確認

1. プロフィールページで「編集」ボタンをクリック
2. 以下の情報を変更:
   - 名前: 「更新テストユーザー」
   - 自己紹介: 「プロフィールを更新しました。テスト実行中です。」
3. 「保存」ボタンをクリック

**期待結果**:
- 成功メッセージ「プロフィールを更新しました」が表示される
- 編集モードが終了する
- 新しい情報が表示される
- アバターの頭文字が「更」または「更新」に変わる

**チェックポイント**:
- ✅ 保存中はローディング表示が出る
- ✅ ページをリロードしても変更が保持されている
- ✅ 文字数カウンターが正しく動作する

---

### 📏 Test 4: 文字数制限のチェック

**目的**: 入力フィールドの文字数制限が機能することを確認

#### 4.1 名前の文字数制限（50文字）

1. 「編集」ボタンをクリック
2. 名前フィールドに51文字以上入力を試みる:
   ```
   あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをん123456
   ```

**期待結果**:
- エラーメッセージ「名前は50文字以内で入力してください」が表示される
- 保存ボタンが無効化される
- 文字数カウンター「51/50」が赤色で表示される

#### 4.2 自己紹介の文字数制限（200文字）

1. 自己紹介フィールドに201文字以上入力を試みる

**期待結果**:
- エラーメッセージ「自己紹介は200文字以内で入力してください」が表示される
- 保存ボタンが無効化される
- プログレスバーが警告色（180文字以上）または赤色（200文字超）になる

**チェックポイント**:
- ✅ リアルタイムでバリデーションが動作する
- ✅ エラー状態で保存ボタンが押せない
- ✅ キャンセルすると元のデータに戻る

---

### 🔒 Test 5: パスワード変更の動作

**目的**: パスワード変更機能が正しく動作することを確認

1. セキュリティセクションの「パスワード変更」ボタンをクリック
2. パスワード変更ダイアログが開く
3. 以下の情報を入力:
   - 現在のパスワード: `Test1234!`
   - 新しいパスワード: `NewPass1234!`
   - 新しいパスワード（確認）: `NewPass1234!`
4. 「変更する」ボタンをクリック

**期待結果**:
- 成功メッセージが表示される
- 「セキュリティのため、再度ログインしてください」のメッセージ
- 2秒後に自動的にログアウトされ、サインインページへリダイレクト

#### 5.1 パスワードバリデーションチェック

以下のケースでエラーが表示されることを確認:

1. **現在のパスワードが間違っている場合**
   - 現在: `WrongPass!` → エラー「現在のパスワードが正しくありません」

2. **新パスワードが要件を満たさない場合**
   - `short1!` → エラー「8文字以上である必要があります」
   - `password123` → エラー「大文字、小文字、数字、特殊文字を含む必要があります」

3. **確認用パスワードが一致しない場合**
   - 新: `NewPass1234!`、確認: `Different1234!` → エラー「パスワードが一致しません」

**チェックポイント**:
- ✅ パスワード表示/非表示トグルが動作する
- ✅ エラーメッセージが適切に表示される
- ✅ ダイアログの閉じるボタンが動作する

---

### ❌ Test 6: エラー処理の確認

**目的**: エラー時の処理が適切に行われることを確認

#### 6.1 ネットワークエラーのシミュレーション

1. 開発者ツールのNetworkタブを開く
2. オフラインモードに設定
3. プロフィール編集を試みる

**期待結果**:
- エラーメッセージ「プロフィールの更新に失敗しました」が表示される
- 編集内容は保持される
- オンラインに戻して再試行できる

#### 6.2 セッションタイムアウト

1. 長時間放置してセッションを切らす
2. プロフィール更新を試みる

**期待結果**:
- 認証エラーが表示される
- ログインページへリダイレクトされる

---

## パフォーマンスチェックリスト

### レスポンシブデザイン
- [ ] モバイル表示（375px）で正しく表示される
- [ ] タブレット表示（768px）で正しく表示される
- [ ] デスクトップ表示（1920px）で正しく表示される

### アクセシビリティ
- [ ] キーボードのみで全操作が可能
- [ ] Tabキーでフォーカスが適切に移動する
- [ ] Escキーでダイアログが閉じる
- [ ] スクリーンリーダーで適切に読み上げられる

### パフォーマンス
- [ ] プロフィール取得が1秒以内に完了する
- [ ] 更新処理が2秒以内に完了する
- [ ] 文字入力時にラグがない

---

## テスト結果記録

| テスト項目 | 結果 | 備考 |
|-----------|------|------|
| Test 1: 認証チェック | ⬜ Pass / ⬜ Fail | |
| Test 2: プロフィール表示 | ⬜ Pass / ⬜ Fail | |
| Test 3: 情報更新 | ⬜ Pass / ⬜ Fail | |
| Test 4: 文字数制限 | ⬜ Pass / ⬜ Fail | |
| Test 5: パスワード変更 | ⬜ Pass / ⬜ Fail | |
| Test 6: エラー処理 | ⬜ Pass / ⬜ Fail | |

**テスト実施日**: ___________
**テスター名**: ___________
**環境**: ___________

## トラブルシューティング

### よくある問題と解決方法

1. **ログインできない**
   - MongoDBが起動しているか確認
   - テストユーザーが作成されているか確認
   - `.env.local`にNEXTAUTH_SECRETが設定されているか確認

2. **プロフィールが取得できない**
   - `/api/profile`エンドポイントが正しく動作しているか確認
   - ネットワークタブでAPIレスポンスを確認

3. **更新が保存されない**
   - コンソールでエラーを確認
   - MongoDBの接続状態を確認

4. **パスワード変更後ログインできない**
   - `test-profile-setup.js`を再実行してパスワードをリセット