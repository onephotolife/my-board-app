# 掲示板機能 手動テスト手順書

## 事前準備

### 1. テストデータの作成
```bash
# テストユーザーと投稿を作成
node scripts/test-board.js
```

### 2. 開発サーバーの起動
```bash
npm run dev
```

### 3. テストアカウント情報

| ユーザー | Email | Password | 状態 | 用途 |
|---------|-------|----------|------|------|
| テストユーザー1 | test1@example.com | Test1234! | 認証済み | 投稿作成・編集・削除テスト |
| テストユーザー2 | test2@example.com | Test1234! | 認証済み | 他人の投稿に対する権限テスト |
| 未認証ユーザー | test3@example.com | Test1234! | 未認証 | メール未認証時の動作テスト |

---

## テストケース

### 🔐 TC01: 未ログイン時のアクセス制限

**目的**: 認証なしでは掲示板にアクセスできないことを確認

**手順**:
1. ブラウザのシークレットモードを開く
2. http://localhost:3000/board にアクセス
3. サインインページにリダイレクトされることを確認

**期待結果**:
- ✅ /auth/signin にリダイレクトされる
- ✅ callbackUrl に /board が含まれている

---

### 👤 TC02: ログインと掲示板アクセス

**目的**: 正常にログインして掲示板にアクセスできることを確認

**手順**:
1. test1@example.com でログイン
2. /board にアクセス

**チェックポイント**:
- ✅ ログイン成功
- ✅ 掲示板ページが表示される
- ✅ 投稿一覧が表示される
- ✅ 「新規投稿」ボタンが表示される

---

### 📝 TC03: 新規投稿の作成

**目的**: 投稿を正常に作成できることを確認

**手順**:
1. test1@example.com でログイン
2. /board にアクセス
3. 「新規投稿」ボタンをクリック
4. 以下を入力:
   - タイトル: "テスト投稿 " + 現在時刻
   - 本文: "これはテスト投稿です。正常に投稿できることを確認しています。"
   - タグ: "テスト", "動作確認"
5. 「投稿する」をクリック

**チェックポイント**:
- ✅ 投稿フォームが表示される
- ✅ 文字数カウンターが動作する
- ✅ タグを追加・削除できる
- ✅ 投稿後、一覧ページにリダイレクト
- ✅ 新規投稿が一覧の最上部に表示される
- ✅ 投稿者情報が正しく表示される

---

### 📏 TC04: 文字数制限の検証

**目的**: タイトルと本文の文字数制限が機能することを確認

**テストデータ**:
```javascript
// タイトル: 100文字制限
const title100 = "あ".repeat(100);  // OK
const title101 = "あ".repeat(101);  // NG

// 本文: 1000文字制限
const content1000 = "あ".repeat(1000);  // OK
const content1001 = "あ".repeat(1001);  // NG
```

**手順**:
1. 新規投稿フォームを開く
2. タイトルに101文字入力を試みる
3. 本文に1001文字入力を試みる

**チェックポイント**:
- ✅ タイトルは100文字で入力が止まる
- ✅ 本文は1000文字で入力が止まる
- ✅ 文字数カウンターが正確に表示される
- ✅ 制限文字数ちょうどで投稿できる

---

### ✏️ TC05: 自分の投稿の編集

**目的**: 自分の投稿を編集できることを確認

**手順**:
1. test1@example.com でログイン
2. 自分の投稿の「︙」メニューをクリック
3. 「編集」を選択
4. タイトルと本文を変更
5. 「更新する」をクリック

**チェックポイント**:
- ✅ 編集フォームに既存データが表示される
- ✅ 変更内容が保存される
- ✅ 更新後、一覧に反映される
- ✅ 更新日時が変更される

---

### 🗑️ TC06: 自分の投稿の削除

**目的**: 自分の投稿を削除できることを確認

**手順**:
1. test1@example.com でログイン
2. 自分の投稿の「︙」メニューをクリック
3. 「削除」を選択
4. 確認ダイアログで「削除」をクリック

**チェックポイント**:
- ✅ 削除確認ダイアログが表示される
- ✅ キャンセルで削除が中止される
- ✅ 削除実行で投稿が消える
- ✅ ページをリロードしても表示されない

---

### 🚫 TC07: 他人の投稿の編集・削除不可

**目的**: 他人の投稿は編集・削除できないことを確認

**手順**:
1. test2@example.com でログイン
2. test1の投稿を表示
3. メニューボタンの有無を確認

**チェックポイント**:
- ✅ 他人の投稿にメニューボタンが表示されない
- ✅ URLを直接入力しても編集ページにアクセスできない
   - /board/[投稿ID]/edit にアクセス → エラーまたはリダイレクト
- ✅ APIを直接呼んでも権限エラーになる

---

### 📄 TC08: ページネーション

**目的**: 投稿が多い場合のページネーション動作を確認

**準備**: 20件以上の投稿を作成

**チェックポイント**:
- ✅ 1ページあたり10件表示（デフォルト）
- ✅ 「前のページ」「次のページ」ボタンが動作
- ✅ ページ番号が正しく表示される
- ✅ 最新の投稿が最初のページに表示される

---

### 🔄 TC09: リアルタイム更新

**目的**: 投稿の追加・編集・削除がリアルタイムで反映されることを確認

**手順**:
1. ブラウザで2つのタブを開く
2. 両方でtest1@example.comでログイン
3. タブ1で新規投稿を作成
4. タブ2をリロードせずに確認

**チェックポイント**:
- ✅ 新規投稿が即座に表示される
- ✅ 編集内容が反映される
- ✅ 削除した投稿が消える

---

### 🔍 TC10: ステータスによる表示制御

**目的**: deleted/draft ステータスの投稿が表示されないことを確認

**手順**:
1. データベースで直接ステータスを変更
2. 一覧ページをリロード

**チェックポイント**:
- ✅ status: 'published' の投稿のみ表示
- ✅ status: 'deleted' の投稿は非表示
- ✅ status: 'draft' の投稿は非表示

---

## パフォーマンステスト

### ⚡ PT01: 大量データでの動作

**準備**:
```javascript
// 100件の投稿を作成するスクリプト
for (let i = 0; i < 100; i++) {
  await fetch('/api/posts', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      title: `パフォーマンステスト投稿 ${i}`,
      content: `これは${i}番目のテスト投稿です。`,
      tags: ['performance', 'test']
    })
  });
}
```

**チェックポイント**:
- ✅ 100件でも3秒以内に表示
- ✅ ページネーションが正常動作
- ✅ メモリリークがない

---

## セキュリティテスト

### 🔒 ST01: SQLインジェクション対策

**テスト内容**:
- タイトルに `'; DROP TABLE posts; --` を入力
- 本文に `<script>alert('XSS')</script>` を入力

**期待結果**:
- ✅ 文字列として安全に保存される
- ✅ スクリプトが実行されない
- ✅ データベースに影響なし

### 🔒 ST02: CSRF対策

**テスト内容**:
- 外部サイトから投稿APIを呼ぶ
- 認証トークンなしでAPIアクセス

**期待結果**:
- ✅ 401 Unauthorized エラー
- ✅ 投稿が作成されない

---

## バグレポートテンプレート

問題を発見した場合は、以下の形式で報告してください：

```markdown
### 問題の概要
[簡潔な説明]

### 再現手順
1. [手順1]
2. [手順2]
3. [手順3]

### 期待される動作
[正しい動作]

### 実際の動作
[問題のある動作]

### 環境
- ブラウザ: [Chrome/Firefox/Safari等]
- OS: [Windows/Mac/Linux]
- ユーザー: [使用したテストアカウント]

### スクリーンショット
[可能であれば添付]

### エラーログ
[コンソールエラーがあれば添付]
```

---

## チェックリスト

### 基本機能
- [ ] ログイン/ログアウト
- [ ] 投稿の作成
- [ ] 投稿の表示
- [ ] 投稿の編集（自分のみ）
- [ ] 投稿の削除（自分のみ）
- [ ] ページネーション

### アクセス制御
- [ ] 未ログイン時のリダイレクト
- [ ] 他人の投稿の編集不可
- [ ] 他人の投稿の削除不可
- [ ] メール未認証時の制限

### バリデーション
- [ ] タイトル100文字制限
- [ ] 本文1000文字制限
- [ ] 必須項目のチェック
- [ ] XSS対策

### UI/UX
- [ ] レスポンシブデザイン
- [ ] エラーメッセージ表示
- [ ] ローディング表示
- [ ] 削除確認ダイアログ

### パフォーマンス
- [ ] 初回ロード3秒以内
- [ ] ページ切り替え1秒以内
- [ ] 大量データでの動作

---

## トラブルシューティング

### よくある問題と解決方法

**Q: ログインできない**
- A: MongoDB が起動しているか確認
- A: メールアドレスとパスワードが正しいか確認
- A: emailVerified が true になっているか確認

**Q: 投稿が表示されない**
- A: status が 'published' になっているか確認
- A: ブラウザキャッシュをクリア
- A: コンソールエラーを確認

**Q: 編集・削除ボタンが表示されない**
- A: 投稿の author が自分の user.id と一致するか確認
- A: セッション情報が正しいか確認

---

最終更新: 2024年