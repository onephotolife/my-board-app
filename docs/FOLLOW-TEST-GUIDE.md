# ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

## æ¦‚è¦
ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½ã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚2ç¨®é¡ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

### 1. çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆJestï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/__tests__/models/follow.test.ts`

åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼š
- åŸºæœ¬çš„ãªãƒ•ã‚©ãƒ­ãƒ¼æ“ä½œ
- ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ›´æ–°ç¢ºèª
- é‡è¤‡ãƒ•ã‚©ãƒ­ãƒ¼ã®é˜²æ­¢
- ã‚¢ãƒ³ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½
- ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼/ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ãƒªã‚¹ãƒˆã®å–å¾—
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### 2. ç°¡æ˜“ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/test-follow-feature.js`

ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼š
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸è¦
- ã‚«ãƒ©ãƒ•ãƒ«ãªå‡ºåŠ›
- ä¸»è¦æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

## å®Ÿè¡Œæ–¹æ³•

### æ–¹æ³•1: ç°¡æ˜“ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰
```bash
# ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
npm run test:follow
```

**å‡ºåŠ›ä¾‹**ï¼š
```
ğŸš€ ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹

ğŸ“Š MongoDBæ¥ç¶šæˆåŠŸ

==================================================
ğŸ“ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
==================================================

1ï¸âƒ£ åŸºæœ¬çš„ãªãƒ•ã‚©ãƒ­ãƒ¼æ“ä½œ
  âœ… PASS: ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒBã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã§ãã‚‹

2ï¸âƒ£ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ›´æ–°ç¢ºèª
  âœ… PASS: Aã®ãƒ•ã‚©ãƒ­ãƒ¼æ•°ãŒ1ã«ãªã‚‹
  âœ… PASS: Bã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ãŒ1ã«ãªã‚‹
  âœ… PASS: Aã®ãƒ•ã‚©ãƒ­ãƒ¼æ•°ãŒ2ã«ãªã‚‹
  âœ… PASS: Aã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ãŒ1ã«ãªã‚‹

3ï¸âƒ£ é‡è¤‡ãƒ•ã‚©ãƒ­ãƒ¼ã®é˜²æ­¢
  âœ… PASS: é‡è¤‡ãƒ•ã‚©ãƒ­ãƒ¼ã§ã‚¨ãƒ©ãƒ¼
  âœ… PASS: é‡è¤‡è©¦è¡Œå¾Œã‚‚ã‚«ã‚¦ãƒ³ãƒˆã¯å¤‰ã‚ã‚‰ãªã„

4ï¸âƒ£ ã‚¢ãƒ³ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½
  âœ… PASS: Bã®ãƒ•ã‚©ãƒ­ãƒ¼ã‚’è§£é™¤ã§ãã‚‹
  âœ… PASS: Aã®ãƒ•ã‚©ãƒ­ãƒ¼æ•°ãŒ1æ¸›ã‚‹
  âœ… PASS: Bã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ãŒ0ã«ãªã‚‹

5ï¸âƒ£ ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¼
  âœ… PASS: ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¼æ•°ãŒæ›´æ–°ã•ã‚Œã‚‹
  âœ… PASS: ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¼ãƒ•ãƒ©ã‚°ãŒè¨­å®šã•ã‚Œã‚‹

6ï¸âƒ£ è‡ªå·±ãƒ•ã‚©ãƒ­ãƒ¼é˜²æ­¢
  âœ… PASS: è‡ªåˆ†è‡ªèº«ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã§ããªã„

==================================================
ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
==================================================

  åˆè¨ˆ: 13 ãƒ†ã‚¹ãƒˆ
  æˆåŠŸ: 13 ãƒ†ã‚¹ãƒˆ
  å¤±æ•—: 0 ãƒ†ã‚¹ãƒˆ
  æˆåŠŸç‡: 100%

âœ… ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ã¾ã—ãŸï¼
```

### æ–¹æ³•2: Jestãƒ†ã‚¹ãƒˆ
```bash
# Jestã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm run test:follow:jest

# ã¾ãŸã¯
jest src/__tests__/models/follow.test.ts --verbose
```

### æ–¹æ³•3: å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
```bash
# ã™ã¹ã¦ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm run test:unit

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œ
npm run test:coverage
```

## ãƒ†ã‚¹ãƒˆå†…å®¹

### 1. åŸºæœ¬çš„ãªãƒ•ã‚©ãƒ­ãƒ¼æ“ä½œ âœ…
- ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒ¦ãƒ¼ã‚¶ãƒ¼Bã‚’ãƒ•ã‚©ãƒ­ãƒ¼
- è‡ªåˆ†è‡ªèº«ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã§ããªã„
- å­˜åœ¨ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã§ããªã„
- ç„¡åŠ¹ãªIDã§ãƒ•ã‚©ãƒ­ãƒ¼ã§ããªã„

### 2. ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ›´æ–° âœ…
- ãƒ•ã‚©ãƒ­ãƒ¼æ™‚ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
- è¤‡æ•°ãƒ•ã‚©ãƒ­ãƒ¼æ™‚ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
- ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¼æ™‚ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
- mutualFollowsCountã®æ­£ç¢ºæ€§

### 3. é‡è¤‡ãƒ•ã‚©ãƒ­ãƒ¼é˜²æ­¢ âœ…
- åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é‡è¤‡ãƒ•ã‚©ãƒ­ãƒ¼ä¸å¯
- MongoDBãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã®å‹•ä½œç¢ºèª

### 4. ã‚¢ãƒ³ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½ âœ…
- ãƒ•ã‚©ãƒ­ãƒ¼è§£é™¤ã®å‹•ä½œ
- ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ¸›ç®—
- ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¼è§£é™¤æ™‚ã®å‡¦ç†
- ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ãƒ³ãƒ•ã‚©ãƒ­ãƒ¼é˜²æ­¢

### 5. ãƒªã‚¹ãƒˆå–å¾— âœ…
- ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ãƒªã‚¹ãƒˆå–å¾—
- ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ãƒªã‚¹ãƒˆå–å¾—
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

### 6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ âœ…
- updateFollowCountsã®å®Ÿè¡Œæ™‚é–“
- å¤§é‡ãƒ•ã‚©ãƒ­ãƒ¼æ™‚ã®å‡¦ç†é€Ÿåº¦

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### MongoDBãŒèµ·å‹•ã—ã¦ã„ãªã„
```bash
# MongoDBèµ·å‹•ï¼ˆmacOSï¼‰
brew services start mongodb-community

# Dockerä½¿ç”¨ã®å ´åˆ
docker run -d -p 27017:27017 mongo:latest
```

### mongodb-memory-serverã‚¨ãƒ©ãƒ¼
```bash
# ä¾å­˜é–¢ä¿‚ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install --save-dev mongodb-memory-server
```

### ãƒ†ã‚¹ãƒˆãŒé…ã„
- åˆå›å®Ÿè¡Œæ™‚ã¯mongodb-memory-serverã®ãƒã‚¤ãƒŠãƒªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™
- 2å›ç›®ä»¥é™ã¯é«˜é€ŸåŒ–ã•ã‚Œã¾ã™

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã‚‹
```bash
# MongoDBã‚·ã‚§ãƒ«ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
mongosh
> use board-app-test
> db.users.deleteMany({ email: /^test.*@test\.com$/ })
> db.follows.deleteMany({})
```

## CI/CDçµ±åˆ

### GitHub Actionsä¾‹
```yaml
name: Test Follow Feature

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '20'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Run follow tests
      run: npm run test:follow
      env:
        MONGODB_URI: mongodb://localhost:27017/test
```

## é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1. **æ©Ÿèƒ½é–‹ç™ºå‰**ï¼šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¾çŠ¶ç¢ºèª
2. **é–‹ç™ºä¸­**ï¼šwatchãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   ```bash
   npm run test:watch -- follow.test
   ```
3. **é–‹ç™ºå¾Œ**ï¼šå…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ
4. **ã‚³ãƒŸãƒƒãƒˆå‰**ï¼šç°¡æ˜“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
5. **PRå‰**ï¼šã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª

## ãƒ†ã‚¹ãƒˆæˆåŠŸåŸºæº–

- âœ… å…¨13é …ç›®ãŒPASS
- âœ… ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒæ­£ç¢º
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–ã‚’æº€ãŸã™ï¼ˆ< 1ç§’ï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ•´åˆæ€§ç¶­æŒ

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **E2Eãƒ†ã‚¹ãƒˆè¿½åŠ **: Playwrightã§UIãƒ†ã‚¹ãƒˆ
2. **è² è·ãƒ†ã‚¹ãƒˆ**: å¤§é‡ãƒ•ã‚©ãƒ­ãƒ¼æ™‚ã®æ€§èƒ½æ¸¬å®š
3. **APIãƒ†ã‚¹ãƒˆ**: RESTã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
4. **é€šçŸ¥ãƒ†ã‚¹ãƒˆ**: ãƒ•ã‚©ãƒ­ãƒ¼é€šçŸ¥ã®å‹•ä½œç¢ºèª