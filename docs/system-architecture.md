# システム構成図

## 1. システム全体構成

### 1.1 アーキテクチャ概要

```
┌─────────────────────────────────────────────────────────────┐
│                         クライアント層                          │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                    Webブラウザ                        │    │
│  │         (Chrome, Firefox, Safari, Edge)              │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
                              ↓↑ HTTPS
┌─────────────────────────────────────────────────────────────┐
│                      アプリケーション層                         │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                    Next.js 15.4.5                    │    │
│  │  ┌────────────────────────────────────────────┐     │    │
│  │  │           フロントエンド (React)             │     │    │
│  │  │  - Pages (App Router)                      │     │    │
│  │  │  - Components (MUI)                        │     │    │
│  │  │  - Styling (Tailwind CSS + Emotion)       │     │    │
│  │  └────────────────────────────────────────────┘     │    │
│  │  ┌────────────────────────────────────────────┐     │    │
│  │  │           バックエンド (API Routes)         │     │    │
│  │  │  - RESTful API                            │     │    │
│  │  │  - Mongoose ODM                           │     │    │
│  │  │  - TypeScript                             │     │    │
│  │  └────────────────────────────────────────────┘     │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
                              ↓↑ MongoDB Protocol
┌─────────────────────────────────────────────────────────────┐
│                        データベース層                          │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                   MongoDB Atlas                      │    │
│  │                 (Cloud Database)                     │    │
│  │  - Database: board-app                              │    │
│  │  - Collection: posts                                │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

## 2. 技術スタック詳細

### 2.1 フロントエンド技術

```
┌──────────────────────────────────────────────────────┐
│                  フロントエンド構成                     │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────┐    ┌──────────────┐             │
│  │   React 19   │    │  TypeScript  │             │
│  │              │    │      5       │             │
│  └──────────────┘    └──────────────┘             │
│         ↓                    ↓                      │
│  ┌────────────────────────────────┐                │
│  │      Next.js 15.4.5            │                │
│  │    (App Router使用)            │                │
│  └────────────────────────────────┘                │
│         ↓                                          │
│  ┌──────────────┐    ┌──────────────┐            │
│  │  Material-UI │    │ Tailwind CSS │            │
│  │     (MUI)    │    │      v4      │            │
│  │      v7      │    │              │            │
│  └──────────────┘    └──────────────┘            │
│         ↓                    ↓                     │
│  ┌────────────────────────────────┐               │
│  │         Emotion                │               │
│  │    (CSS-in-JS for MUI)        │               │
│  └────────────────────────────────┘               │
│                                                    │
└──────────────────────────────────────────────────┘
```

### 2.2 バックエンド技術

```
┌──────────────────────────────────────────────────────┐
│                  バックエンド構成                      │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ┌────────────────────────────────┐                │
│  │    Next.js API Routes          │                │
│  │   /api/posts/*                 │                │
│  └────────────────────────────────┘                │
│              ↓                                      │
│  ┌────────────────────────────────┐                │
│  │       Mongoose 8.9.3           │                │
│  │     (MongoDB ODM)              │                │
│  └────────────────────────────────┘                │
│              ↓                                      │
│  ┌────────────────────────────────┐                │
│  │    MongoDB Driver              │                │
│  └────────────────────────────────┘                │
│              ↓                                      │
│  ┌────────────────────────────────┐                │
│  │    MongoDB Atlas               │                │
│  │  (クラウドデータベース)          │                │
│  └────────────────────────────────┘                │
│                                                     │
└──────────────────────────────────────────────────────┘
```

## 3. データフロー

### 3.1 投稿作成フロー

```
ユーザー入力
    ↓
[PostForm Component]
    ↓
バリデーション (クライアント側)
    ↓
POST /api/posts
    ↓
[API Route Handler]
    ↓
Mongooseバリデーション
    ↓
MongoDB Atlas保存
    ↓
レスポンス返却
    ↓
画面更新
```

### 3.2 投稿取得フロー

```
ページロード
    ↓
useEffect Hook
    ↓
GET /api/posts
    ↓
[API Route Handler]
    ↓
MongoDB Atlas検索
    ↓
データ取得 (降順ソート)
    ↓
JSONレスポンス
    ↓
State更新
    ↓
画面レンダリング
```

## 4. ディレクトリ構造

```
my-board-app/
├── src/
│   ├── app/                 # Next.js App Router
│   │   ├── api/             # APIエンドポイント
│   │   │   └── posts/       # 投稿関連API
│   │   │       ├── route.ts
│   │   │       └── [id]/
│   │   │           └── route.ts
│   │   ├── layout.tsx       # ルートレイアウト
│   │   ├── page.tsx         # メインページ
│   │   ├── providers.tsx    # Context Providers
│   │   └── globals.css      # グローバルスタイル
│   │
│   ├── components/          # Reactコンポーネント
│   │   ├── PostForm.tsx     # 投稿フォーム
│   │   ├── PostItem.tsx     # 投稿表示
│   │   └── EditDialog.tsx   # 編集ダイアログ
│   │
│   ├── lib/                 # ユーティリティ
│   │   └── mongodb.ts       # DB接続管理
│   │
│   ├── models/              # データモデル
│   │   └── Post.ts          # Postスキーマ
│   │
│   └── types/               # 型定義
│       └── global.d.ts
│
├── docs/                    # ドキュメント
├── logs/                    # ログファイル
├── public/                  # 静的ファイル
├── .env.local              # 環境変数
├── package.json            # 依存関係
├── tsconfig.json           # TypeScript設定
├── tailwind.config.ts      # Tailwind設定
└── next.config.ts          # Next.js設定
```

## 5. 環境別構成

### 5.1 開発環境

```
┌────────────────┐
│  開発者PC      │
│                │
│  - Node.js     │
│  - npm         │
│  - VS Code     │
└────────────────┘
        ↓
┌────────────────┐
│  localhost:3000│
│                │
│  Next.js Dev   │
│  (Turbopack)   │
└────────────────┘
        ↓
┌────────────────┐
│ MongoDB Atlas  │
│  (開発用DB)    │
└────────────────┘
```

### 5.2 本番環境（想定）

```
┌────────────────┐
│   CDN          │
│  (Cloudflare)  │
└────────────────┘
        ↓
┌────────────────┐
│   Vercel       │
│                │
│  Next.js App   │
│  (Edge Runtime)│
└────────────────┘
        ↓
┌────────────────┐
│ MongoDB Atlas  │
│  (本番用DB)    │
│  - レプリカ    │
│  - バックアップ │
└────────────────┘
```

## 6. セキュリティアーキテクチャ

### 6.1 セキュリティレイヤー

```
┌─────────────────────────────────────┐
│         セキュリティ対策             │
├─────────────────────────────────────┤
│                                     │
│  フロントエンド                      │
│  - XSS防止 (React自動エスケープ)     │
│  - CSP設定                          │
│                                     │
│  API層                              │
│  - 入力値検証                       │
│  - レート制限（将来実装）            │
│                                     │
│  データベース                        │
│  - TLS/SSL暗号化                    │
│  - 環境変数による認証情報管理         │
│  - IPホワイトリスト                  │
│                                     │
└─────────────────────────────────────┘
```

## 7. パフォーマンス最適化

### 7.1 最適化戦略

```
フロントエンド最適化
├── コード分割 (Next.js自動)
├── 画像最適化 (next/image)
├── フォント最適化
└── CSS最小化

バックエンド最適化
├── API応答キャッシュ
├── データベース接続プール
└── インデックス最適化

ネットワーク最適化
├── gzip圧縮
├── HTTP/2
└── CDN活用
```

## 8. 監視とログ

### 8.1 監視ポイント

```
アプリケーション監視
├── エラー率
├── 応答時間
├── アクティブユーザー数
└── API呼び出し回数

インフラ監視
├── CPU使用率
├── メモリ使用率
├── ディスク使用率
└── ネットワーク帯域

データベース監視
├── クエリ実行時間
├── 接続数
├── ストレージ使用量
└── レプリケーション遅延
```

## 9. 拡張性の考慮

### 9.1 水平スケーリング

```
現在の構成:
    [単一インスタンス]
           ↓
将来の構成:
    [ロードバランサー]
         ↓    ↓    ↓
    [App1] [App2] [App3]
         ↓    ↓    ↓
    [MongoDB Atlas Cluster]
```

### 9.2 マイクロサービス化（将来）

```
現在: モノリシック
    [Next.js App]

将来: マイクロサービス
    [API Gateway]
        ↓
    ├── [投稿サービス]
    ├── [ユーザーサービス]
    ├── [通知サービス]
    └── [分析サービス]
```