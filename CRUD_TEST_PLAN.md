# 会員制掲示板 CRUD機能テスト計画書

## 1. テスト概要

### 対象システム
- **アプリケーション**: 会員制掲示板
- **バージョン**: 1.0.0
- **テスト日**: 2025年8月14日
- **環境**: Next.js 15.4.5, MongoDB, NextAuth.js v5

### テスト範囲
1. **認証機能**: ユーザー登録、ログイン、ログアウト、セッション管理
2. **投稿CRUD**: Create（作成）、Read（閲覧）、Update（更新）、Delete（削除）
3. **権限管理**: 自分の投稿のみ編集・削除可能
4. **セキュリティ**: CSRF保護、XSS対策、認証チェック

---

## 2. 単体テスト（Unit Test）

### 2.1 コンポーネントテスト

#### PostForm コンポーネント
```javascript
// テスト項目
- [ ] フォームの初期表示
- [ ] 入力値のバリデーション（必須項目）
- [ ] 文字数制限の動作（タイトル100文字、内容1000文字）
- [ ] 送信ボタンの有効/無効切り替え
- [ ] フォーム送信時のonSubmit呼び出し
- [ ] 送信後のフォームクリア
```

#### PostItem コンポーネント
```javascript
// テスト項目
- [ ] 投稿データの正しい表示
- [ ] 編集ボタンの表示条件（自分の投稿のみ）
- [ ] 削除ボタンの表示条件（自分の投稿のみ）
- [ ] onEdit/onDeleteコールバックの呼び出し
- [ ] 日時のフォーマット表示
```

### 2.2 ユーティリティ関数テスト

#### InputSanitizer
```javascript
// テスト項目
- [ ] XSSペイロードの無害化
- [ ] HTMLタグの除去
- [ ] スクリプトタグの除去
- [ ] イベントハンドラの除去
- [ ] 通常テキストの保持
```

#### RateLimiter
```javascript
// テスト項目
- [ ] トークンバケットの初期化
- [ ] リクエスト許可の判定
- [ ] レート制限超過時の拒否
- [ ] リセット時間の計算
- [ ] 残りトークン数の取得
```

---

## 3. 結合テスト（Integration Test）

### 3.1 API エンドポイントテスト

#### POST /api/posts（投稿作成）
```javascript
// テスト項目
- [ ] 認証済みユーザーの投稿作成成功
- [ ] 未認証ユーザーの401エラー
- [ ] 不正なデータの400エラー
- [ ] CSRFトークンなしの403エラー
- [ ] データベースへの保存確認
- [ ] レスポンスデータの検証
```

#### GET /api/posts（投稿一覧取得）
```javascript
// テスト項目
- [ ] 認証済みユーザーの一覧取得
- [ ] ページネーション動作
- [ ] ソート順の確認
- [ ] フィルタリング機能
- [ ] 権限情報の付与
```

#### PUT /api/posts/[id]（投稿更新）
```javascript
// テスト項目
- [ ] 自分の投稿の更新成功
- [ ] 他人の投稿の403エラー
- [ ] 存在しない投稿の404エラー
- [ ] 不正なデータの400エラー
- [ ] 更新日時の自動更新
```

#### DELETE /api/posts/[id]（投稿削除）
```javascript
// テスト項目
- [ ] 自分の投稿の削除成功
- [ ] 他人の投稿の403エラー
- [ ] 存在しない投稿の404エラー
- [ ] データベースからの削除確認
```

### 3.2 認証フローテスト

#### ユーザー登録フロー
```javascript
// テスト項目
- [ ] 新規ユーザー登録
- [ ] メール認証
- [ ] 重複メールアドレスのエラー
- [ ] パスワード強度チェック
- [ ] セッション生成
```

#### ログイン/ログアウトフロー
```javascript
// テスト項目
- [ ] 正しい認証情報でのログイン
- [ ] 不正な認証情報のエラー
- [ ] セッション維持
- [ ] ログアウト処理
- [ ] セッション破棄
```

---

## 4. E2Eテスト（End-to-End Test）

### 4.1 ユーザーシナリオテスト

#### シナリオ1: 新規ユーザーの投稿作成
```
1. トップページアクセス
2. 新規登録ボタンクリック
3. 登録フォーム入力
4. メール認証
5. ログイン
6. 掲示板ページへ遷移
7. 新規投稿作成
8. 投稿が一覧に表示される
```

#### シナリオ2: 既存ユーザーの投稿編集
```
1. ログインページアクセス
2. 認証情報入力
3. ダッシュボードへリダイレクト
4. 掲示板ページへ遷移
5. 自分の投稿の編集ボタンクリック
6. 編集ダイアログで内容変更
7. 保存ボタンクリック
8. 変更が反映される
```

#### シナリオ3: 投稿の削除
```
1. ログイン済み状態で掲示板アクセス
2. 自分の投稿の削除ボタンクリック
3. 確認ダイアログ表示
4. 削除実行
5. 一覧から投稿が消える
```

### 4.2 エラーハンドリングテスト

#### ネットワークエラー
```javascript
// テスト項目
- [ ] API通信失敗時のエラー表示
- [ ] リトライ機能
- [ ] オフライン時の動作
```

#### 権限エラー
```javascript
// テスト項目
- [ ] 他人の投稿編集試行時のエラー
- [ ] 未認証アクセス時のリダイレクト
- [ ] セッション切れの処理
```

---

## 5. セキュリティテスト

### 5.1 認証・認可テスト
```javascript
// テスト項目
- [ ] 未認証ユーザーのアクセス制限
- [ ] 他ユーザーデータへのアクセス制限
- [ ] トークン偽装の検出
- [ ] セッションハイジャック対策
```

### 5.2 入力検証テスト
```javascript
// テスト項目
- [ ] XSS攻撃ペイロードの無害化
- [ ] SQLインジェクション対策
- [ ] NoSQLインジェクション対策
- [ ] ファイルアップロード制限
```

### 5.3 CSRF対策テスト
```javascript
// テスト項目
- [ ] CSRFトークンの生成
- [ ] トークン検証
- [ ] 不正トークンの拒否
- [ ] Double Submit Cookie動作
```

---

## 6. パフォーマンステスト

### 6.1 レスポンス時間
```javascript
// 基準値
- [ ] 投稿一覧取得: < 500ms
- [ ] 投稿作成: < 1000ms
- [ ] 投稿更新: < 1000ms
- [ ] 投稿削除: < 500ms
```

### 6.2 負荷テスト
```javascript
// テスト項目
- [ ] 同時接続数: 100ユーザー
- [ ] レート制限動作: 5req/分
- [ ] データベース接続プール
- [ ] メモリリーク確認
```

---

## 7. テスト実行手順

### 準備
```bash
# 1. テスト環境構築
npm install --save-dev jest @testing-library/react @testing-library/jest-dom
npm install --save-dev playwright @playwright/test

# 2. テストデータベース準備
mongod --dbpath ./test-db

# 3. 環境変数設定
cp .env.test.example .env.test
```

### 実行コマンド
```bash
# 単体テスト
npm run test:unit

# 結合テスト
npm run test:integration

# E2Eテスト
npm run test:e2e

# 全テスト実行
npm run test:all

# カバレッジレポート
npm run test:coverage
```

---

## 8. 合格基準

### カバレッジ目標
- **単体テスト**: 80%以上
- **結合テスト**: 70%以上
- **E2Eテスト**: 主要シナリオ100%

### パフォーマンス基準
- **レスポンス時間**: 95%が1秒以内
- **エラー率**: 0.1%以下
- **可用性**: 99.9%以上

### セキュリティ基準
- **OWASP Top 10**: 全項目対策済み
- **認証**: 多要素認証対応可能
- **暗号化**: TLS 1.3使用

---

## 9. テスト結果記録

### テスト実行結果
| テスト種別 | 実行数 | 成功 | 失敗 | スキップ | カバレッジ |
|----------|-------|------|------|---------|-----------|
| 単体テスト | - | - | - | - | -% |
| 結合テスト | - | - | - | - | -% |
| E2Eテスト | - | - | - | - | -% |

### 不具合一覧
| ID | 優先度 | 概要 | ステータス |
|----|-------|------|----------|
| - | - | - | - |

---

## 10. 承認

- **テスト実施者**: _______________
- **レビュー者**: _______________
- **承認者**: _______________
- **承認日**: _______________

---

**注記**: このテスト計画書は継続的に更新され、新機能追加時には対応するテストケースを追加すること。