# コメント機能調査レポート

## 実施日時
2025年8月25日 13:30-13:40 JST

## 実施者
【担当: #3 フロントエンドプラットフォームリード（FE-PLAT）／R: FE-PLAT／A: FE-PLAT】

## エグゼクティブサマリー
**本番環境ではコメント機能が表示されていないことが確認されました。**
ソースコードにはコメント機能が実装されていますが、本番環境のHTMLには一切レンダリングされていません。

## 1. 調査結果

### 1.1 コード実装状況
| 項目 | 状態 | 詳細 |
|------|------|------|
| フロントエンド実装 | ✅ 存在 | src/app/posts/[id]/page.tsx（422-497行） |
| コメントデータ | ハードコーディング | useEffect内で仮データ設定（125-138行） |
| APIエンドポイント | ❌ 未実装 | /api/comments関連なし |
| データベースモデル | ❌ 未実装 | Commentモデルなし |

### 1.2 本番環境の状況
| URL | コメント表示 | 証拠 |
|-----|------------|------|
| /posts/68abc8def7bca9fae572d156 | ❌ 表示されない | HTMLに要素なし |
| /posts/68abc7cef7bca9fae572d145 | ❌ 表示されない | HTMLに要素なし |

## 2. 技術的分析

### 2.1 実装されているコード（src/app/posts/[id]/page.tsx）

#### ハードコーディングされたデータ（125-138行）
```typescript
setComments([
  {
    _id: '1',
    content: 'この投稿とても参考になりました！',
    author: 'ユーザー1',
    createdAt: new Date().toISOString()
  },
  {
    _id: '2',
    content: '私も同じ意見です。素晴らしい内容ですね。',
    author: 'ユーザー2',
    createdAt: new Date(Date.now() - 3600000).toISOString()
  }
]);
```

#### コメントUI実装（422-497行）
- コメントセクション全体（Card）
- コメント入力フォーム
- コメント一覧表示
- 「まだコメントがありません」表示

### 2.2 本番環境での検証結果
```
テスト実行: 2025/8/25 13:37:05
HTML検索結果:
❌ "コメント": 見つからない
❌ "この投稿とても参考になりました": 見つからない
❌ "ユーザー1": 見つからない
❌ Card/List/Avatar要素: なし
```

## 3. 考えられる原因

### 3.1 可能性1：ビルド時の除外
- 本番ビルドでコメント関連コードが除外されている
- 環境変数による条件分岐が存在

### 3.2 可能性2：サーバーサイドでの非表示
- 'use client'ディレクティブによるCSR
- サーバー側でのレンダリング時に除外

### 3.3 可能性3：デプロイの不整合
- ローカルと本番のコードが異なる
- ビルドキャッシュの問題

## 4. コメント削除時の影響評価

### 4.1 削除対象コード
| ファイル | 削除範囲 | 行数 |
|---------|---------|------|
| src/app/posts/[id]/page.tsx | 69-74行（interface） | 6行 |
| src/app/posts/[id]/page.tsx | 111-113行（state） | 3行 |
| src/app/posts/[id]/page.tsx | 125-138行（仮データ） | 14行 |
| src/app/posts/[id]/page.tsx | 249-264行（submit関数） | 16行 |
| src/app/posts/[id]/page.tsx | 407-412行（ボタン） | 6行 |
| src/app/posts/[id]/page.tsx | 422-497行（UIセクション） | 76行 |

**合計削除行数**: 約121行

### 4.2 リスク評価
| リスク項目 | 影響度 | 理由 |
|-----------|--------|------|
| エラー発生 | 低 | 独立したセクション |
| レイアウト崩れ | 低 | Card単位で削除可能 |
| 機能への影響 | なし | 他機能と独立 |
| ユーザー体験 | 良好 | 現在も表示されていない |

## 5. 現状の問題点

### 5.1 不整合な状態
1. **コードは存在するが表示されない**
   - ユーザーには見えない
   - 開発者を混乱させる

2. **未完成の実装**
   - APIなし
   - DBモデルなし
   - 常に同じ仮データ

3. **メンテナンス負債**
   - 使われないコード
   - 将来の開発を複雑化

## 6. 推奨事項

### 6.1 即時対応
**コメント機能の完全削除を推奨**

理由：
1. 現在表示されていない（ユーザー影響なし）
2. 未完成の機能（APIなし）
3. コードの整理とメンテナンス性向上

### 6.2 削除手順
1. interface Comment削除
2. コメント関連state削除
3. useEffect内の仮データ設定削除
4. handleCommentSubmit関数削除
5. コメントボタン削除
6. コメントセクション全体削除

## 7. 証拠ブロック

### テスト実行結果
```
実行ファイル: test-comment-detailed.js
実行時刻: 2025/8/25 13:37:05
対象URL: https://board.blankbrainai.com/posts/68abc8def7bca9fae572d156
結果: HTMLにコメント要素なし
```

### API確認結果
```
/api/comments: 404 Not Found
/api/posts/[id]/comments: 404 Not Found
コメントAPIは未実装
```

## 8. 結論

**コメント機能は削除すべきです。**

### 根拠
1. 本番環境で既に表示されていない
2. 未完成の実装（モックデータのみ）
3. 削除してもエラーリスクが低い
4. コードベースの簡潔化に貢献

### 注意事項
- 本番環境で表示されていない理由は不明
- しかし、削除による悪影響はない

## 9. 署名

`I attest: all numbers come from the attached evidence.`

RACI: R: FE-PLAT (#3) / A: FE-PLAT (#3) / C: QA (#21), FE (#4) / I: EM (#1), ARCH (#2)

---

## 付録: テストスクリプト

### 調査スクリプト
- test-comments-investigation.js
- test-comment-detailed.js

すべてのテストスクリプトは `/Users/yoshitaka.yamagishi/Documents/projects/my-board-app/` に保存されています。