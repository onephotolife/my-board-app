# feature/member-board → main マージ前チェックリスト

## 🔍 必須確認事項

### 1. コード品質
- [ ] **すべてのテストがパス**
  ```bash
  npm test
  npm run test:e2e  # E2Eテストがある場合
  ```

- [ ] **リンターエラーなし**
  ```bash
  npm run lint
  ```

- [ ] **TypeScript型エラーなし**
  ```bash
  npm run type-check
  # または
  npx tsc --noEmit
  ```

- [ ] **ビルド成功**
  ```bash
  npm run build
  ```

### 2. 機能確認
- [ ] **全機能が仕様通り動作**
  - [ ] ユーザー登録機能
  - [ ] ログイン/ログアウト機能
  - [ ] 会員限定投稿機能
  - [ ] 投稿の編集・削除（権限チェック含む）
  - [ ] メール送信機能
  - [ ] 管理者機能

- [ ] **エラーハンドリング確認**
  - [ ] ネットワークエラー時の表示
  - [ ] 認証エラー時のリダイレクト
  - [ ] バリデーションエラーの表示
  - [ ] 404/500エラーページ

- [ ] **レスポンシブデザイン確認**
  - [ ] モバイル表示（375px〜）
  - [ ] タブレット表示（768px〜）
  - [ ] デスクトップ表示（1024px〜）

### 3. パフォーマンス
- [ ] **Lighthouse スコア維持（90+）**
  ```bash
  # ローカルでLighthouse実行
  npm run build && npm start
  # Chrome DevToolsでLighthouse実行
  ```

- [ ] **バンドルサイズ確認**
  ```bash
  npm run analyze  # bundle analyzerがある場合
  # または
  npm run build
  # .next/analyze/client.html を確認
  ```

- [ ] **初回ロード時間（3秒以内）**
- [ ] **メモリリークなし**（長時間使用テスト）

### 4. セキュリティ
- [ ] **認証・認可の実装確認**
  - [ ] JWT トークンの適切な管理
  - [ ] セッション管理
  - [ ] CSRF対策
  - [ ] XSS対策

- [ ] **機密情報の確認**
  - [ ] 環境変数に機密情報を移動
  - [ ] .env.localがgitignoreに含まれている
  - [ ] APIキーがハードコーディングされていない
  - [ ] デバッグログに機密情報が出力されない

- [ ] **依存関係の脆弱性チェック**
  ```bash
  npm audit
  npm audit fix  # 修正可能な場合
  ```

- [ ] **入力値検証**
  - [ ] SQLインジェクション対策
  - [ ] サーバーサイドバリデーション

### 5. データベース
- [ ] **マイグレーション準備**
  - [ ] 新しいスキーマの文書化
  - [ ] マイグレーションスクリプト作成
  - [ ] ロールバック手順の確認

- [ ] **インデックス最適化**
  - [ ] 頻繁にクエリされるフィールドにインデックス
  - [ ] 複合インデックスの検討

- [ ] **データ整合性**
  - [ ] 外部キー制約
  - [ ] ユニーク制約
  - [ ] 必須フィールドの確認

### 6. ドキュメント
- [ ] **README.md更新**
  - [ ] 新機能の説明
  - [ ] セットアップ手順
  - [ ] 環境変数の説明

- [ ] **API仕様書更新**
  - [ ] 新しいエンドポイント
  - [ ] リクエスト/レスポンス形式
  - [ ] エラーコード一覧

- [ ] **CHANGELOG.md更新**
  ```markdown
  ## [Unreleased]
  ### Added
  - 会員制掲示板機能
  - ユーザー認証システム
  - メール通知機能
  - 権限管理システム
  ```

- [ ] **環境変数ドキュメント**
  ```bash
  # .env.example を更新
  MONGODB_URI=
  JWT_SECRET=
  SMTP_HOST=
  SMTP_USER=
  SMTP_PASS=
  ```

### 7. デプロイ準備
- [ ] **環境変数の設定確認**
  - [ ] Vercelに必要な環境変数を追加
  - [ ] 本番用の値を設定

- [ ] **データベース準備**
  - [ ] 本番DBの接続確認
  - [ ] 初期データの準備（必要な場合）
  - [ ] バックアップの取得

- [ ] **外部サービス設定**
  - [ ] メールサービス（SendGrid等）
  - [ ] 認証プロバイダー（必要な場合）
  - [ ] CDN設定（必要な場合）

### 8. コードレビュー
- [ ] **セルフレビュー完了**
  ```bash
  # 差分確認
  git diff main...feature/member-board
  
  # ファイル一覧
  git diff --name-only main...feature/member-board
  ```

- [ ] **不要なコードの削除**
  - [ ] console.log の削除
  - [ ] コメントアウトされたコード
  - [ ] デバッグ用コード
  - [ ] TODOコメントの解決

- [ ] **コード規約の遵守**
  - [ ] 命名規則
  - [ ] ファイル構成
  - [ ] インポート順序

### 9. テスト
- [ ] **単体テスト作成**
  - [ ] カバレッジ80%以上
  - [ ] エッジケースのテスト
  - [ ] エラーケースのテスト

- [ ] **統合テスト作成**
  - [ ] API エンドポイントテスト
  - [ ] 認証フローテスト
  - [ ] データベース操作テスト

- [ ] **E2Eテスト作成**（可能な場合）
  - [ ] ユーザー登録フロー
  - [ ] ログイン/投稿フロー
  - [ ] 権限別の動作確認

### 10. ブラウザ互換性
- [ ] **対象ブラウザでの動作確認**
  - [ ] Chrome (最新)
  - [ ] Firefox (最新)
  - [ ] Safari (最新)
  - [ ] Edge (最新)
  - [ ] モバイルブラウザ

### 11. アクセシビリティ
- [ ] **キーボード操作対応**
- [ ] **スクリーンリーダー対応**
- [ ] **適切なARIAラベル**
- [ ] **カラーコントラスト基準**

### 12. 最終確認
- [ ] **mainブランチとの同期**
  ```bash
  git checkout main
  git pull origin main
  git checkout feature/member-board
  git merge main  # コンフリクト解決
  ```

- [ ] **不要なファイルの確認**
  ```bash
  git clean -n  # 削除されるファイルの確認
  ```

- [ ] **コミット履歴の整理**（必要な場合）
  ```bash
  # スカッシュマージの検討
  git rebase -i main
  ```

## 📋 PR作成前の最終コマンド

```bash
# 1. 最新のmainを取得
git checkout main && git pull origin main

# 2. feature/member-boardに戻る
git checkout feature/member-board

# 3. mainをマージ
git merge main

# 4. テスト実行
npm test && npm run lint && npm run build

# 5. 差分確認
git diff main...feature/member-board --stat

# 6. PR作成
gh pr create --base main --title "feat: 会員制掲示板機能の実装" \
  --body "$(cat .github/pull_request_template.md)"
```

## ⚠️ マージ後の作業

1. **本番環境の監視**
   - エラーログの確認
   - パフォーマンスメトリクス
   - ユーザーフィードバック

2. **ホットフィックスの準備**
   - 緊急修正手順の確認
   - ロールバック手順の確認

3. **次のイテレーション計画**
   - フィードバックの収集
   - 改善点の洗い出し
   - 次期機能の計画